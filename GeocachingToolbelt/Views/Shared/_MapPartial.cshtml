@model MapData
<script src="~/lib/here/mapsjs-core.js" type="text/javascript" charset="utf-8"></script>
<script src="~/lib/here/mapsjs-service.js" type="text/javascript" charset="utf-8"></script>
<script src="~/lib/here/mapsjs-ui.js" type="text/javascript" charset="utf-8"></script>
<script src="~/lib/here/mapsjs-mapevents.js" type="text/javascript" charset="utf-8"></script>

<div style="width: 100%; height: 480px" id="mapContainer"></div>

<div data-container="coordinates" style="display: none;">
    @foreach (var coord in Model.Coordinates)
    {
        <coord data-lat="@coord.Nord" data-long="@coord.East" />
    }
    @if (@Model.Hightlight != null)
    {
        <coord data-lat="@Model.Hightlight.Nord" data-long="@Model.Hightlight.East" data-color="red" />
    }
</div>

<script>
    var platform = new H.service.Platform({
        apikey: 'vNMhXVZ9xoOqHv6Kb_vCNKQlg_NgfmHtd5_Qk2R1iK0',
	    useHTTPS: true
    });

    var defaultLayers = platform.createDefaultLayers();

    var map = new H.Map(
        document.getElementById('mapContainer'),
        defaultLayers.vector.normal.map,
    );

    // Add coords
    var group = new H.map.Group();

    document.querySelectorAll("[data-container='coordinates'] coord").forEach(coord => {
        var latitude = parseFloat(coord.dataset.lat);
        var longitude = parseFloat(coord.dataset.long);
        coords = { lat: latitude, lng: longitude };
        var pngIcon = new H.map.Icon("/images/marker-" + (coord.dataset.color != undefined ? coord.dataset.color : "blue") + ".png");

	    var marker = new H.map.Marker({
		    lat: latitude,
            lng: longitude
        }, {icon: pngIcon});

        group.addObject(marker);
    });

    map.addObject(group);

    map.getViewModel().setLookAtData({
        bounds: group.getBoundingBox()
    });

    var behavior = new H.mapevents.Behavior(new H.mapevents.MapEvents(map));
</script>
